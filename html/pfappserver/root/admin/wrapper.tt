<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>[% l('Administrator') %] - A3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A3 Administrator">

    <!-- styles -->
[% FOREACH css = cssFiles -%]
    <link rel="stylesheet" href="[% c.uri_for("/static/${css}.css") %]">
[% END -%]
    <link rel="stylesheet" href="[% c.uri_for('/static/css/styles.css') %]">
    <link rel="stylesheet" href="[% c.uri_for('/static/app/application.css') %]">
    <link rel="stylesheet" href="[% c.uri_for('/static/admin/common.css') %]">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
         <script src="[% c.uri_for('/static/app/html5.js') %]"></script>
    <![endif]-->
    <!-- [% FOREACH css = cssFiles -%]
        <link rel="stylesheet" href="[% c.uri_for("/static/${css}.css") %]">
    [% END -%] -->
        <link rel="stylesheet" href="[% c.uri_for('/static/css/A3styleNew.css') %]">
        <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">

  </head>
  [% SET SHOW_READONLY_ERROR = c.user_allowed_in_admin() && readonly_mode %]
  <body[% IF SHOW_READONLY_ERROR %] class="navbar-error"[% END %]>

    <div class="alert alert-block hide">
      <button class="close" data-dismiss="alert">&times;</button>
      <strong>[% l('Warning!') %]</strong> <span></span>
    </div>

    <div class="alert alert-success hide">
      <button class="close" data-dismiss="alert">&times;</button>
      <strong>[% l('Success!') %]</strong> <span></span>
    </div>

    <div class="alert alert-error hide">
      <button class="close" data-dismiss="alert">&times;</button>
      <strong>[% l('Error!') %]</strong> <span></span>
    </div>

    <div id="navbar" class="navbar navbar-fixed-top navbar-inverse[% IF SHOW_READONLY_ERROR %] navbar-error[% END %]">
      <div class="navbar-inner">
        <div class="row-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>

          <a class="brand visible-phone" href="#">
            <img src="[% c.uri_for('/static/img/a3Logo.svg') %]"/>
          </a>
          <a class="brand span3 hidden-phone" href="#">
            <img src="[% c.uri_for('/static/img/a3Logo.svg') %]"/>
          </a>
          [%- IF c.user_allowed_in_admin() %]
          <div class="nav-collapse">
            <ul class="nav nav-header">
              [%- IF can_access_any("REPORTS","SERVICES") %]
              <li[% ' class="active"' IF c.action.name == 'status' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired  %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Status') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('status')) %]">[% l('Status') %]</a>
                [% END %]
              </li>
              [%- END %]

              [%- IF can_access("REPORTS") %]
              <li[% ' class="active"' IF c.action.name == 'reports' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired  %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Reports') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('reports')) %]">[% l('Reports') %]</a>
                [% END %]
              </li>
              [%- END %]

              [%- IF can_access("AUDITING_READ") %]
              <li[% ' class="active"' IF c.action.name == 'auditing' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired  %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Auditing') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('auditing')) %]">[% l('Auditing') %]</a>
                [% END %]
              </li>
              [%- END %]

              [%- IF can_access("NODES_READ") %]
              <li[% ' class="active"' IF c.action.name == 'nodes' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired  %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Nodes') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('nodes')) %]">[% l('Nodes') %]</a>
                [% END %]
              </li>
              [%- END %]

              [%- IF can_access_any("USERS_READ", "USERS_READ_SPONSORED") %]
              <li[% ' class="active"' IF c.action.name == 'users' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Users') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('users')) %]">[% l('Users') %]</a>
                [% END %]
              </li>
              [%- END %]

              [%- IF can_access_group_any("CONFIGURATION_GROUP_READ") %]
              <li[% ' class="active"' IF c.action.name == 'configuration' %]>
                [% IF is_usage_over_capacity or is_entitlement_expired  %]
                  <a style="color: #333; cursor: not-allowed;" >[% l('Configuration') %]</a>
                [% ELSE %]
                  <a href="[% c.uri_for(c.controller('Admin').action_for('configuration')) %]">[% l('Configuration') %]</a>
                [% END %]
              </li>
              [%- END %]
            </ul>

            <ul class="nav nav-header pull-right">
              <li>
                 <a href="[% c.uri_for(c.controller('Admin').action_for('help')) %]"><img src="[% c.uri_for('/static/img/icon-help.svg') %]"/></a>
              </li>
              <li class="dropdown" data-toggle="tooltip" title="[% l('Perform tasks') %]">
                <a href="" class="dropdown-toggle" data-toggle="dropdown"><img src="[% c.uri_for('/static/img/icon-tools.svg') %]"/></a>
                <ul class="dropdown-menu">
                  <li class="disabled"><a href="#" disabled><b>[% l('Click a task to run/re-run') %]</b></a></li>
                  <li id="checkup_task"><a href="" id="checkup_task_toggle">[% l('Perform checkup') %]</a></li>
                  <li id="fixpermissions_task"><a href="" id="fixpermissions_task_toggle">[% l('Fix permissions') %]</a></li>
                  [% IF is_master_node or !is_cluster_enabled %]
                      [% IF is_usage_over_capacity or is_entitlement_expired  %]
                        <li id="upgrade_task"><a style="color: #c3c3c3; cursor: not-allowed;">[% l('Update software') %]</a></li>
                      [% ELSE %]
                        <li id="upgrade_task"><a href="[% c.uri_for(c.controller('Admin').action_for('update')) %]" id="upgrade_task_toggle">[% l('Update software') %]</a></li>
                      [% END %]
                  [% END %]
                </ul>
              </li>
              <li class="dropdown">
                <a href="" class="dropdown-toggle" data-toggle="dropdown"><img src="[% c.uri_for('/static/img/icon-account.svg') %]"/></a>
                <ul class="dropdown-menu">
                  <li><a href="[% c.uri_for(c.controller('Admin').action_for('licenseKeys')) %]"><i class="icon-off"></i> [% l('Manage Licenses') %]</a></li>
                  <li><a id="logout" href="[% c.uri_for(c.controller('Admin').action_for('logout')) %]"><i class="icon-off"></i> [% l('Log out') %]</a></li>
                </ul>
              </li>
              <li class="user_info">
                <span>[% c.user | html %]</span>
              </li>
	          </ul>
          </div>

          [% IF is_eula_accepted %]
          [% ELSE %]
            <!-- <trial indicator -->
            <div class="trialIndicator" id="trialIndicator">
              <div class="trial-clock-indicator pull-right">
                  <img id="clock-icon" src="[% c.uri_for('/static/img/clock.svg') %]"/>
              </div>
              <div id="clockTrialDiv">
                  <p>[% l("Time left of trial: ") %] <span id="daysLeft"></span></p>
                  <div><div id="time-indicator"><div id="time-indicator-bar"></div></div></div>
              </div>
            </div>
          <!--end trialindecator-->
          [% END %]
        </div>
        [%- END %]
        <!-- end of if user allowed in admin-->
        [% IF SHOW_READONLY_ERROR %]
        <div class="row-error">
          <strong>[% l('Warning!') %]</strong>
          <span>[% l('The database is in read-only mode. Not all functionality is available.') %] [% doc('_quorum_behavior', 'Clustering_Guide') | none %]</span>
        </div>
        [% END %]
      </div>
    </div>

    [%- IF c.user_allowed_in_admin() %]

      [% IF is_eula_accepted %]

        [% FOREACH key IN entitlement_keys -%]
          [% IF latestKey.defined %]
            [% IF latestKey.expires_in < key.expires_in %]
              [% SET latestKey = key %]
            [% END %]
          [% ELSE %]
            [% SET latestKey = key %]
          [% END %]
        [% END %]

        [% IF template.name != 'admin/licenseKeys.tt' %]
          [% IF is_entitlement_expired %]
              [% INCLUDE admin/licenseEnforcementModal.tt %]
          [% ELSIF is_usage_over_capacity %]
              [% INCLUDE admin/overUsageModal.tt %]
          [% ELSIF latestKey.defined %]
            [% IF latest_key_expires_in.defined %]
              [% IF latest_key_expires_in < 15 %]
                  [% INCLUDE admin/almostExpiringModal.tt %]
              [% END %]
            [% END %]
          [% END %]
        [% END %]
      [% ELSE %]
        [% IF template.name != 'admin/licenseKeys.tt' %]
            [% IF is_entitlement_expired %]
                [% INCLUDE admin/expiredModal.tt %]
            [% ELSIF is_usage_over_capacity %]
                [% INCLUDE admin/overUsageModal.tt %]
            [% ELSIF expires_in < 16 and expires_in >= 0 %]
                [% INCLUDE admin/almostExpiringModal.tt %]
            [% END %]
        [% END %]
      [% END %]
    [% END %]

 [% content | none %]
    <!-- Le javascript ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script id="labels" type="text/json">
    {
      "Cannot Load Content": "[% l('Cannot Load Content') | js %]",
      "Copy": "[% l('Copy') | js %]",
      "Copied": "[% l('Copied') | js %]"
    }
    </script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/vendor/jquery.min.js') %]"></script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/vendor/jquery-ui.min.js') %]"></script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/vendor/jquery-extra.min.js') %]"></script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/vendor/bootstrap.min.js') %]"></script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/pfappserver.js') %]"></script>
[%- IF c.user_allowed_in_admin() %]
    <script type="text/javascript" src="[% c.uri_for('/static/js/adminWrapper.js') %]"></script>
    <script type="text/javascript" src="[% c.uri_for('/static/js/licenseKeys.js') %]"></script>
  [%- IF can_access_group_any("CONFIGURATION_GROUP_READ") %]
    <script type="" ></script>
  [%- END %]
    [% IF is_eula_accepted %]
      [% IF template.name != 'admin/licenseKeys.tt' %]
          [% IF is_entitlement_expired %]
              <script>openEnforcementModal()</script>
          [% ELSIF is_usage_over_capacity %]
              <script>openOverUsageModal()</script>
          [% ELSIF latestKey.defined %]
            [% IF latest_key_expires_in.defined %]
              <script>openAlmostExpiredModal();</script>
            [% END %]
          [% END %]
      [% END %]
    [% ELSE %]
        [% IF template.name != 'admin/licenseKeys.tt' %]
              <script>openAlmostExpiredModal()</script>
            [% IF is_entitlement_expired %]
              <script>openExpiredModal()</script>
            [% ELSIF is_usage_over_capacity %]
              <script>openOverUsageModal()</script>
            [% END %]
        [% END %]
    [% END %]
[%- END %]
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
[% FOREACH js = jsFiles -%]
    <script type="text/javascript" src="[% c.uri_for("/static/${js}.js") %]" charset="UTF-8"></script>
[% END -%]

 </body>
</html>
